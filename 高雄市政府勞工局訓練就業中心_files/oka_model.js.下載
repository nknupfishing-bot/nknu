(function ($) { $.fn.touchwipe = function (settings) { var config = { min_move_x: 20, min_move_y: 20, wipeLeft: function () { }, wipeRight: function () { }, wipeUp: function () { }, wipeDown: function () { }, preventDefaultEvents: true }; if (settings) $.extend(config, settings); this.each(function () { var startX; var startY; var isMoving = false; function cancelTouch() { this.removeEventListener('touchmove', onTouchMove); startX = null; isMoving = false } function onTouchMove(e) { if (config.preventDefaultEvents) { e.preventDefault() } if (isMoving) { var x = e.touches[0].pageX; var y = e.touches[0].pageY; var dx = startX - x; var dy = startY - y; if (Math.abs(dx) >= config.min_move_x) { cancelTouch(); if (dx > 0) { config.wipeLeft() } else { config.wipeRight() } } else if (Math.abs(dy) >= config.min_move_y) { cancelTouch(); if (dy > 0) { config.wipeDown() } else { config.wipeUp() } } } } function onTouchStart(e) { if (e.touches.length == 1) { startX = e.touches[0].pageX; startY = e.touches[0].pageY; isMoving = true; this.addEventListener('touchmove', onTouchMove, false) } } if ('ontouchstart' in document.documentElement) { this.addEventListener('touchstart', onTouchStart, false) } }); return this } })(jQuery);

function isOldIE() { //判斷是不是舊IE

    var odd_ie = false, //存判斷結果
        _appName = window.navigator.appName,
        _version = window.navigator.appVersion.split(';')[1] || '';

    _version = _version.replace(/[ ]/g, '');

    if (_appName === 'Microsoft Internet Explorer' && (_version === 'MSIE8.0' || _version === 'MSIE7.0' || _version === 'MSIE6.0')) { //如果是 IE6 - IE8
        odd_ie = true;
    }

    window.oldIE = odd_ie;

    return odd_ie;
}

//相簿輪播
$.fn.module_photo = function () {

    //取所有輪播物件
    var $models = $(this);

    //判斷瀏覽器
    var odd_ie = window.oldIE || isOldIE(); //存判斷結果

    $models.each(function () {

        //取物件 & 參數
        var $that = $(this), //取情境
            _slider = $that.data('slider'), //是否輪播
            _sliderSpeed = parseInt($that.data('sliderspeed'), 10), //切換速度
            _animateSpeed = parseInt($that.data('animatespeed'), 10); //動畫速度

        var $ul = $that.find('ul'), //取播放物件
            $ul_length = $ul.length,
            $ctrl_tools = $that.find('.model_ctrl_tools');

        //播放按鈕
        var _playButton_tools = '';

        var _index = 0; //開始播放的順序

        var _isPlay = 0; //判斷是否撥放
        var timer; //設定計時器

        //判斷瀏覽器版本
        if (odd_ie && !$that.hasClass('straight')) { //如果是 IE6 - IE8、沒有直式樣式

            $ul.each(function () { //給每個ul的li寫入行內寬度 

                var $this = $(this),
                    $li = $this.children('li'), //取li
                    $li_length = $li.length; //取length

                if ($li.length < 10) { //如果li的數量小於10個
                    $li.css('width', (100 / $li_length).toFixed(3) - 0.1 + '%'); //寫入寬度 ( -0.1 是因為IE7 滿百不能並排 )
                }
            });
        }

        //如果有一個以上的
        if ($ul_length > 1) {

            //隱藏ul並顯示第一個
            $ul.hide().eq(_index).show();

            var url = window.location.href;
            //新增左右按鈕
            if (url.indexOf("/EN/") >= 0 || url.indexOf("/en/") >= 0) {
                $ctrl_tools.prepend('<a class="ctrl_left" href="#" title="Previous" role="button">&lsaquo;</a>');
                $ctrl_tools.append('<a class="ctrl_right" href="#" title="Next" role="button">&rsaquo;</a>');
                $ctrl_tools.prepend('<div class="ctrl_btn"><a class="is-play" href="#" role="button" title="Slideshow[playing]">Playing</a></div>');//播放按鈕
            }
            else {
                $ctrl_tools.prepend('<a class="ctrl_left" href="#" title="上一張" role="button">&lsaquo;</a>');
                $ctrl_tools.append('<a class="ctrl_right" href="#" title="下一張" role="button">&rsaquo;</a>');
                $ctrl_tools.prepend('<div class="ctrl_btn"><a class="is-play" href="#" role="button" title="輪播功能[正在播放中]">播放中</a></div>');//播放按鈕
            }


            //取物件
            var $ctrl_left = $ctrl_tools.find('.ctrl_left').data('dir', -1), //抓左右按鈕並設定方向參數
                $ctrl_right = $ctrl_tools.find('.ctrl_right').data('dir', 1),
                $btns = $ctrl_left.add($ctrl_right); //取按鈕集
            var $ctrl_btn = $that.find('.model_ctrl_tools .ctrl_btn'), //上一層控制物件
                $play_btn = $ctrl_btn.find('a'); //播放按鈕
            $play_btn.css({
                "margin": "0 5px",
                "position": "unset"
            });
            $ctrl_tools.css({
                "display": "flex",
                "justify-content": "flex-end"
            });
            //按下按鈕
            $btns.click(function (event) {
                event.preventDefault(); //停止預設動作

                var $this = $(this),
                    _dir = $this.data('dir'); //取方向參數

                slider(_dir);
            });
            //按下播放按鈕
            $play_btn.on('click', function (event) {
                event.preventDefault();
                if (_isPlay == 0) {
                    _isPlay = 1;
                    play_btn_change(_isPlay);
                    timer = setTimeout(auto, _sliderSpeed);
                }
                else if (_isPlay == 1) {
                    _isPlay = 0;
                    isClick = true;
                    play_btn_change(_isPlay);
                    clearTimeout(timer);
                }
            });
            //改變按鈕狀態
            function play_btn_change(isPlay) {
                if (isPlay == 0) {
                    $play_btn.removeClass('is-play').addClass('is-Pause');
                    if (url.indexOf("/EN/") >= 0 || url.indexOf("/en/") >= 0) {
                        $play_btn.text('Pause').attr('title', 'Slideshow[pausing]');
                    }
                    else {
                        $play_btn.text('暫停中').attr('title', '輪播功能[暫停中]');
                    }
                }
                else if (isPlay == 1) {
                    $play_btn.removeClass('is-pause').addClass('is-play');

                    if (url.indexOf("/EN/") >= 0 || url.indexOf("/en/") >= 0) {
                        $play_btn.text('Playing').attr('title', 'Slideshow[playing]');
                    }
                    else {
                        $play_btn.text('播放中').attr('title', '輪播功能[播放中]');
                    }
                }
            }

            if (_slider) { //如果要輪播

                //設定輪播涵式
                function auto() {
                    slider(1); //播放下一個
                    timer = setTimeout(auto, _sliderSpeed);
                    _isPlay = 1;
                    play_btn_change(_isPlay);
                }

                //設定滑進滑出項目
                $that.mouseover(function () {
                    //clearTimeout(timer); //取消滑鼠移入自動撥放
                });

                $that.mouseout(function () {
                    //timer = setTimeout(auto, _sliderSpeed); //取消滑鼠移出自動撥放
                });
                $ul.keyup(function () { //ul內遇到鍵盤內容暫停
                    clearTimeout(timer);
                    _isPlay = 0;
                    play_btn_change(_isPlay);
                });

                $that.keydown(function () {
                    //timer = setTimeout(auto, _sliderSpeed); //取消鍵盤按下自動撥放
                });

                //輪播開始
                timer = setTimeout(auto, _sliderSpeed);
                _isPlay = 1;
                play_btn_change(_isPlay);
            }

            function slider(_away) { //播放核心

                _index = (_index + _away + $ul_length) % $ul_length; //算出第幾個要被撥放
                $ul.eq(_index).fadeIn(_animateSpeed).siblings('ul').hide(); //show出圖片並把其他隱藏
            }
        }
    });
}

//主視覺輪播
$.fn.oka_slider_model = function ($setting) {
    //取所有輪播物件
    var $models = $(this);

    $models.each(function () {

        //取物件 & 參數
        var $this = $(this), //取情境
            _type = $this.data('type') || 0, //輪播類型
            _slider = $this.data('slider') || false, //是否輪播
            _sliderSpeed = $this.data('sliderspeed') || 5000, //切換速度
            _animateSpeed = $this.data('animatespeed') || 300,
            _animateType = $this.data('slidertype') || 0; //動畫類別

        var $slider_box = $this.find('.slider_model_box'), //取播放區域
            $slider_box_c = $slider_box.children(), //取要播放的子物件
            $slider_box_c_length = $slider_box_c.length, //取播放物件的數量
            $slider_box_img = $slider_box.find('img'), //取播放物件的img
            $slider_box_img_length = $slider_box_img.length; //取播放物件的數量

        var $video = $this.find('video');

        var timer = null; //計時器

        if ($video.length || $this.find('iframe').length) {
            _type = 'vedio';
            _animateType = 1;
        }

        if ($slider_box_c_length <= 1) { //如果沒有輪播項目就停止程式
            setTimeout(function () {
                var $video = $this.find('video');
                if ($video.length > 0) {
                    $video[0].play().catch(err => {
                        console.warn('播放失敗：', err);
                    });
                } else {
                    console.warn('找不到 video 元素');
                }
                //$this.find('video')[0].play();
            }, 1000);

            return false;
        }

        $slider_box_c.eq(0).siblings().hide();

        // 製作附加模組
        var _dom = ''; //存物件字串

        var _list_box = '<div class="slider_list_box"><ul>'; //建立右播放清單
        for (i = 0; i < $slider_box_c.length; i++) {
            _list_box += '<li><a href="#"><div style="background-image: url(' + $slider_box_img.eq(i).attr('src') + ');"></div><div class="h5">' + $slider_box_img.eq(i).attr('alt') + '</div><p>' + $slider_box_img.eq(i).attr('alt') + '</p></a></li>';
        }
        _list_box += '</ul></div>';

        var _ctrl_img_box = '<div class="ctrl_img_box"><ul>'; //建立影像點點
        for (i = 0; i < $slider_box_c.length; i++) {
            _ctrl_img_box += '<li><a href="#" style="background-image: url(' + $slider_box_img.eq(i).attr('src') + ');"></a></li>\n\r';
        }
        _ctrl_img_box += '</ul></div>';

        var _ctrl_dot_box = '<div class="ctrl_dot_box"><ul>'; //建立點點
        for (i = 0; i < $slider_box_c.length; i++) {
            _ctrl_dot_box += '<li><a href="' + $slider_box_c.eq(i).attr('href') + '" target="_blank" title="' + $slider_box_img.eq(i).attr('alt') + '">' + $slider_box_img.eq(i).attr('alt') + '</a></li>\n\r';
        }
        _ctrl_dot_box += '</ul></div>';

        var _ctrl_tools = '';
        var url = window.location.href;
        var _playButton_tools = '';
        var pauseImg = `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='48' height='48' viewBox='0 0 48 48'%3E%3Cg id='is-pause' transform='translate(22919 22848)'%3E%3Ccircle id='Ellipse_141' data-name='Ellipse 141' cx='24' cy='24' r='24' transform='translate(-22919 -22848)' fill='rgba(255,255,255,0)'/%3E%3Cg id='Group_27880' data-name='Group 27880'%3E%3Crect id='Rectangle_4745' data-name='Rectangle 4745' width='6' height='24' rx='3' transform='translate(-22904 -22836)' fill='%23fff'/%3E%3Crect id='Rectangle_4746' data-name='Rectangle 4746' width='6' height='24' rx='3' transform='translate(-22891 -22836)' fill='%23fff'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E%0A`;
        var playImg = `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='48' height='48' viewBox='0 0 48 48'%3E%3Cg id='is-paly' transform='translate(22983 22848)'%3E%3Ccircle id='Ellipse_140' data-name='Ellipse 140' cx='24' cy='24' r='24' transform='translate(-22983 -22848)' fill='rgba(255,255,255,0)'/%3E%3Cpath id='Polygon_6' data-name='Polygon 6' d='M12.527,6.078a4,4,0,0,1,6.946,0L28.58,22.015A4,4,0,0,1,25.107,28H6.893A4,4,0,0,1,3.42,22.015Z' transform='translate(-22942 -22840) rotate(90)' fill='%23fff'/%3E%3C/g%3E%3C/svg%3E%0A`;
        var playButtonStyle = 'display: block; align-items: center; justify-content: flex-start; width: auto; padding: 5px 5px 5px 30px; text-indent: initial; font: initial; color: rgb(255, 255, 255); border-radius: 4px; background: url("' + playImg + '");';

        if (url.indexOf("/EN/") >= 0 || url.indexOf("/en/") >= 0) {
            _ctrl_tools = '<div class="model_ctrl_tools"><a href="#" class="ctrl_left" title="Previous" role="button">&lsaquo;</a><a href="#" class="ctrl_right" title="Next" role="button">&rsaquo;</a></div>', //建立控制按鈕
                _introduce_box = '<div class="slider_introduce_box"><div class="h5"></div><p></p>' + _ctrl_dot_box + '</div>'; //建立左側撥放方框
            _playButton_tools = '<div class="ctrl_btn"><a class="is-play" href="#" role="button" title="Slideshow[playing]" Style="' + playButtonStyle + '">Playing</a></div>';//播放按鈕
        }
        else {
            _ctrl_tools = '<div class="model_ctrl_tools"><a href="#" class="ctrl_left" title="上一張" role="button">&lsaquo;</a><a href="#" class="ctrl_right" title="下一張" role="button">&rsaquo;</a></div>', //建立控制按鈕
                _introduce_box = '<div class="slider_introduce_box"><div class="h5"></div><p></p>' + _ctrl_dot_box + '</div>'; //建立左側撥放方框
            _playButton_tools = '<div class="ctrl_btn"><a class="is-play" href="#" role="button" title="輪播功能[正在播放中]" Style="' + playButtonStyle + '">播放中</a></div>';//播放按鈕
        }


        //依type加入body
        $this.prepend(_playButton_tools)//播放按鈕加在前面
        switch (_type) {
            case 1:
                _dom += _ctrl_tools + '<div class="slider_bottom_box">' + _ctrl_dot_box + '</div>';
                break;

            case 2:
                _dom += '<div class="slider_bottom_box">' + _ctrl_dot_box + '<div class="bg_box"><div class="h5"></div></div></div>';
                break;

            case 3:
                _dom += _ctrl_tools + '<div class="slider_bottom_box"><div class="bg_box">' + _ctrl_dot_box + '<p></p></div></div>';
                break;

            case 4:
                _dom += '<div class="slider_bottom_box">' + _ctrl_dot_box + '</div>' + _list_box;
                break;

            case 5:
                _dom += '<div class="slider_bottom_box"><div class="bg_box">' + _ctrl_dot_box + '<p></p></div></div>' + _list_box;
                break;

            case 6:
                _dom += '<div class="slider_bottom_box"><div class="bg_box">' + _ctrl_img_box + '</div></div>';
                break;

            case 7:
                _dom += _ctrl_tools + '<div class="slider_bottom_box"><div class="bg_box">' + _ctrl_img_box + '</div></div>';
                break;

            case 8:
                _dom += _introduce_box;
                break;

            case 9:
                _dom += _ctrl_tools + _introduce_box + '<div class="slider_bottom_box">' + _ctrl_dot_box + '<div class="bg_box"><div class="h5"></div>' + _ctrl_dot_box + '<p></p></div></div>' + _list_box;
                break;

            case 'vedio':
                _dom += _ctrl_tools + '<div class="slider_bottom_box">' + _ctrl_dot_box + '</div>';
                break;

            default:
                _dom += '<div class="slider_bottom_box">' + _ctrl_dot_box + '</div>';
        }

        $this.append(_dom); //加入模組

        //控制附加模組
        var $ctrl_tools = $this.find('.model_ctrl_tools'), //取控制按鈕組
            $bottom_box = $this.find('.bg_box'), //取下方外層方框
            $introduce_box = $this.find('.slider_introduce_box'), //取左側播放方框
            $list_box = $this.find('.slider_list_box'), //取右播放清單
            $list_box_a = $list_box.find('a'), //&a
            $ctrl_dot_box = $this.find('.ctrl_dot_box'), //取點點
            $ctrl_dot_box_a = $ctrl_dot_box.find('a'), //&a
            $ctrl_img_box = $this.find('.ctrl_img_box'), //取影像點點
            $ctrl_img_box_a = $ctrl_img_box.find('a'); //&a

        var $ctrl_btns = $list_box_a.add($ctrl_dot_box_a).add($ctrl_img_box_a),
            $ctrl_title = $introduce_box.find('h5').add($bottom_box.find('h5')), //取要更新的標題
            $ctrl_text = $introduce_box.find('p').add($bottom_box.find('p')); //取要更新的內文

        var $ctrl_left = $ctrl_tools.find('.ctrl_left').data('dir', -1), //抓左右按鈕並設定方向參數
            $ctrl_right = $ctrl_tools.find('.ctrl_right').data('dir', 1),
            $away_btns = $ctrl_left.add($ctrl_right); //取按鈕集

        var $list_box_ul = $list_box.find('ul'),  //右側清單ul
            $list_box_li = $list_box.find('li'), //右側清單選項
            $list_box_a = $list_box_li.find('a'); //右側清單連結

        var $ctrl_btn = $this.find('.ctrl_btn'),  //播放按鈕上一層框架
            $play_btn = $ctrl_btn.find('a');  //播放按鈕
        $ctrl_btn.css({
            "position": "absolute",
            "top": "5px",
            "right": "5px"
        });


        var _index = 0; //紀錄播放的順序
        var isClick = false;
        var isPlay = 0;

        //tab 影像或右側清單的按鈕
        $ctrl_btns.on('focusin', function () {
            //clearTimeout(timer);
            //isClick = true;
            //var $this = $(this), //取點點
            //    $this_p = $this.parent('li');

            //_index = $this_p.index(); //取點點的順序
            //slider(_index); //播放

            event.preventDefault(); //停止預設動作
            var $this = $(this), //取點點
                $this_p = $this.parent('li');

            _index = $this_p.index(); //取點點的順序
            slider(_index); //播放

        });
        //按下點點或影像或右側清單的按鈕
        $ctrl_btns.on('click', function () {
            event.preventDefault(); //停止預設動作
        });

        //按下左右
        $away_btns.on('click', function (event) {
            event.preventDefault(); //停止預設動作
            isClick = true;
            clearTimeout(timer);
            isPlay = 0;
            play_btn_change(isPlay);
            var $this = $(this),
                _dir = $this.data('dir'); //取方向參數

            change_index(_dir);
        });
        $play_btn.on('click', function (event) {
            event.preventDefault();
            // 切換控制項樣式及狀態
            if (isPlay == 0) {
                isPlay = 1;
                play_btn_change(isPlay);
                timer = setTimeout(auto, _sliderSpeed);
            }
            else if (isPlay == 1) {
                isPlay = 0;
                isClick = true;
                play_btn_change(isPlay);
                clearTimeout(timer);
            }
        });
        //改變按鈕狀態
        function play_btn_change(isPlay) {
            if (isPlay == 0) {
                $play_btn.removeClass('is-play').addClass('is-Pause');
                if (url.indexOf("/EN/") >= 0 || url.indexOf("/en/") >= 0) {
                    $play_btn.text('Pause').attr('title', 'Slideshow[pausing]');
                }
                else {
                    $play_btn.text('暫停中').attr('title', '輪播功能[暫停中]');
                }
                $play_btn.css('background', `url("${pauseImg}") no-repeat 0px 4px / 35% #505050`);
            }
            else if (isPlay == 1) {
                $play_btn.removeClass('is-pause').addClass('is-play');

                if (url.indexOf("/EN/") >= 0 || url.indexOf("/en/") >= 0) {
                    $play_btn.text('Playing').attr('title', 'Slideshow[playing]');
                }
                else {
                    $play_btn.text('播放中').attr('title', '輪播功能[播放中]');
                }
                $play_btn.css('background', `url("${playImg}")  no-repeat 0px 4px / 35% #505050`);
            }
        }

        $this.touchwipe({
            wipeLeft: function () { change_index(1); clearTimeout(timer); isPlay = 0; },
            wipeRight: function () { change_index(-1); clearTimeout(timer); isPlay = 0; },
            min_move_x: 20,
            min_move_y: 20,
            preventDefaultEvents: false
        });

        if (_slider) { //如果要輪播
            //設定計時器

            //設定自動撥放涵式
            function auto() {
                change_index(1);
            }

            setTimeout(function () { //延遲一秒 load 影片
                slider(_index);
            }, 1000);

            //設定滑進滑出項目(移除)
            //$this.mouseover(function () {
            //    if (isClick) {
            //        isClick = false;
            //    }
            //    else {
            //        clearTimeout(timer);
            //        isPlay = 0;
            //        play_btn_change(isPlay);
            //    }
            //});
            //$this.focus(function () {
            //    clearTimeout(timer);
            //});

            //滑鼠移動取消
            //$this.mouseout(function () {
            //    if (isClick) {
            //        isClick = false;
            //    }
            //    else {
            //        timer = setTimeout(auto, _sliderSpeed);
            //        isPlay = 1;
            //        play_btn_change(isPlay)
            //    }
            //});
            $this.keyup(function (event) {
                if (event.key === "Enter") {
                    return; // 按下 Enter 時直接跳出，不執行後續邏輯
                }

                if (isClick) {
                    isClick = false;
                } else {
                    clearTimeout(timer);
                    isPlay = 0;
                    play_btn_change(isPlay);
                }
            });
            $this.keydown(function () {
                if (isClick) {
                    isClick = false;
                }
                else {
                    //按鈕事件就都不要撥放，會干擾已經暫停的撥放
                    //timer = setTimeout(auto, _sliderSpeed);
                    //isPlay = 1;
                    //play_btn_change(isPlay)
                }
            });
            //$this.focusout(function () {
            //    timer = setTimeout(auto, _sliderSpeed);
            //});
        }

        function change_index(_away) { //播放核心

            _index = (_index + _away + $slider_box_c_length) % $slider_box_c_length; //算出第幾個要被撥放
            slider(_index); //播放
        }

        //設定輪播涵式
        function slider(_index) {
            $(document).scrollTop($(window).scrollTop() + 1);
            $(document).scrollTop($(window).scrollTop() - 1);
            var $slider_dom = $slider_box_c.eq(_index), //存要播放的物件與資料
                $slider_img = $slider_box_img.eq(_index), //存要播放的img
                _href = $slider_dom.attr('href') || null;

            //預載下一張圖
            if ($slider_box_c.eq(_index + 1) != null) {
                var $data = $slider_box_c.eq(_index + 1).find('img');
                if ($data.attr('src') == '.' && $data.attr('data-src') != null) {
                    $data.attr('src', $data.attr('data-src'));
                    $data.removeAttr('data-src');
                }
            }

            var $slider_t = _sliderSpeed;

            if ($list_box.length) { //如果有$list_box
                var $list_box_h = $list_box.height() - $bottom_box.height(), //播放的眶
                    $list_box_ul_h = $list_box_ul.height(), //清單的高
                    $list_box_slider_h = $list_box_ul_h + $list_box_li.outerHeight(true) - $list_box_h, //右側清單的高
                    $list_box_item = $list_box_li.eq(_index), ///右側清單的播放項目
                    _top = $list_box_item.position().top; //&離父元素的高

                if ($list_box_h > $list_box_ul_h) { //如果框比撥放清單還高
                    _top = 0;
                } else if (_top > $list_box_slider_h) {
                    for (i = 1; $list_box_li.eq(i).position().top <= $list_box_slider_h; i++) //算出最大的_top
                        _top = $list_box_li.eq(i).position().top;
                }

                $list_box_ul.stop().animate({ //讓右側清單選項滑動
                    'margin-top': -1 * _top
                }, _animateSpeed);
            }

            if (!_animateType) { //如果 data-slidertype 是0
                var _random = Math.floor(Math.random() * 5) + 1;

                slider_core(_random); //總共有 6 種輪播，隨機
            } else {
                slider_core(_animateType);
            }

            $ctrl_title.text($slider_img.attr('alt')); //更新title
            $ctrl_text.text($slider_img.attr('alt')); //更新text

            $list_box_a.removeClass('is_active').eq(_index).addClass('is_active');
            $ctrl_dot_box_a.removeClass('is_active').eq(_index).addClass('is_active');
            $ctrl_img_box_a.removeClass('is_active').eq(_index).addClass('is_active');

            var $current_video = $slider_dom.find('video');

            $video.each(function (i, n) { //如果有影片就撥放

                if (window.oldIE) {
                    return;
                }

                n.pause();
                n.currentTime = 0;
            });

            if ($current_video.length) { //播放影片
                var $vedio = $current_video.get(0);

                $slider_t = $vedio.duration * 1000 + 100; //100 緩衝

                $vedio.play();
            }

            function slider_core(_animateType) { //提供"副總"多種輪播模式(昏)

                $this.find('.pic_slider_mask').remove();

                switch (_animateType) {

                    case 2:

                        var $dom = $('<div class="pic_slider_mask">'),
                            $img = $('<img src=' + $slider_img.attr('src') + '>');

                        $dom.append($img);

                        $slider_box.append($dom); //插入 dom

                        $dom.css({ //設定css
                            'position': 'absolute',
                            'width': '100%',
                            'left': '0',
                            'top': '100%'
                        });

                        $dom.stop().animate({ //執行下而上的動畫
                            'top': 0
                        }, _animateSpeed, function () {
                            $slider_dom.show().siblings('a').hide(); //show出圖片並刪除遮罩
                            $dom.remove();
                        });

                        break;

                    case 3:

                        var $dom = $('<div class="pic_slider_mask">'),
                            $img = $('<img src=' + $slider_img.attr('src') + '>');

                        $dom.append($img);

                        $slider_box.append($dom); //插入 dom

                        $dom.css({ //設定css
                            'position': 'absolute',
                            'width': '100%',
                            'left': '100%',
                            'top': 0
                        });

                        $dom.stop().animate({ //執行右而左的動畫
                            'left': 0
                        }, _animateSpeed, function () {
                            $slider_dom.show().siblings('a').hide(); //show出圖片並刪除遮罩
                            $dom.remove();
                        });

                        break;

                    case 4: //依序掉落

                        var length = 12, //設定片數
                            _new_animateSpeed = _animateSpeed / length,
                            _all_time = _animateSpeed * 2 - _new_animateSpeed,
                            $img_src = $slider_img.attr('src'),
                            $doms = $(), //遮罩
                            virtual_ani = 0; //虛擬動畫

                        for (i = 0; i < length; i++) { //加入 jquery dom

                            var $dom = $('<div class="pic_slider_mask">'),
                                $img = $('<img src=' + $img_src + '>');

                            $dom.append($img);

                            $dom.css({
                                'position': 'absolute',
                                'left': 0,
                                'top': 0,
                                'width': (100 / length) * (i + 1) + '%',
                                'overflow': 'hidden',
                                'bottom': '100%'
                            });

                            $img.css({
                                'width': (length * 100) / (i + 1) + '%'
                            });

                            $doms = $doms.add($dom);
                        }

                        $slider_box.append($doms); //插入dom

                        $doms.each(function (i, d) { //依序執行動畫

                            var _index = i;

                            (function (i) { //閉包傳遞i

                                $(d).stop().delay(_new_animateSpeed * i).animate({
                                    'bottom': 0
                                }, _animateSpeed);

                            })(_index)
                        });

                        $slider_dom.stop().animate({ //結束後顯示圖片並刪除遮罩，以虛擬動畫計時
                            virtual_ani: 100
                        }, _all_time, function () {

                            $slider_dom.show().siblings('a').hide();
                            $doms.remove();
                        });

                        break;

                    case 5: //上下交叉

                        var length = 10, //設定片數
                            $img_src = $slider_img.attr('src'),
                            $doms = $(), //單數遮罩
                            $domd = $(), //雙數遮罩
                            virtual_ani = 0; //虛擬動畫

                        for (i = 0; i < length; i++) { //加入 jquery dom

                            var $dom = $('<div class="pic_slider_mask">'),
                                $img = $('<img src=' + $img_src + '>');

                            $dom.css({
                                'position': 'absolute',
                                'left': (100 / length) * i + '%',
                                'width': (100 / length) + '%',
                                'overflow': 'hidden'
                            });

                            $dom.append($img);

                            $img.css({
                                'width': (length * 100) + '%',
                                'margin-left': -100 * i + '%'
                            });

                            if (i % 2) { //單數與雙數分開來設定，並分開存取

                                $dom.css({
                                    'top': 0,
                                    'bottom': '100%'
                                });

                                $doms = $doms.add($dom);

                            } else {

                                $dom.css({
                                    'bottom': 0,
                                    'top': '100%'
                                });

                                $domd = $domd.add($dom);
                            }
                        }

                        $slider_box.append($doms).append($domd); //插入dom

                        $doms.stop().animate({ //分別執行兩種動畫
                            'bottom': 0
                        }, _animateSpeed);

                        $domd.stop().animate({
                            'top': 0
                        }, _animateSpeed);

                        $slider_dom.stop().animate({ //結束後顯示圖片並刪除遮罩，以虛擬動畫計時
                            virtual_ani: 100
                        }, _animateSpeed, function () {

                            $slider_dom.show().siblings('a').hide();
                            $doms.remove();
                            $domd.remove();
                        });

                        break;

                    default:
                        $slider_dom.fadeIn(_animateSpeed).siblings().hide(); //show出圖片並把其他隱藏
                }
            }

            //輪播開始

            if (_slider) {
                clearTimeout(timer);
                timer = setTimeout(auto, $slider_t);
                isPlay = 1;
                play_btn_change(isPlay)
            }
            $(document).scrollTop($(window).scrollTop() + 1);
            $(document).scrollTop($(window).scrollTop() - 1);
        }
    });
}

//底部輪播
$.fn.oka_banner_slider_model = function ($setting) {

    //取所有輪播物件
    var $models = $(this);

    $models.each(function () {

        //取物件 & 參數
        var $this = $(this), //取情境
            _slider = $this.data('slider'), //是否輪播
            _all = $this.data('all'), //是否輪播
            _sliderSpeed = $this.data('sliderspeed') || 5000, //切換速度
            _animateSpeed = $this.data('animatespeed'), //動畫速度
            $mask = $this.find('.banner_mask'),
            $ul = $mask.children('ul'); //取播放物件

        $ul.children('li').each(function () {
            var $this = $(this);

            if ($this.css('display') === 'none') {
                $this.remove();
            }
        });

        var $li = $ul.children('li'),
            $li_length = $li.length,
            $ctrl_tools = $this.find('.model_ctrl_tools');

        var $slider_dom = $();

        var $mask_width = $mask.width(), //取遮罩寬度
            $li_width = $li.width(), //取li寬度
            $li_all_width = $li_width * $li_length; //算出所有li總和寬度

        var isPlay = 1;//是否撥放中
        var _playButton_tools = '';//撥放按鈕

        //播放/暫停按鈕圖案
        var pauseImg = `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='48' height='48' viewBox='0 0 48 48'%3E%3Cg id='is-pause' transform='translate(22919 22848)'%3E%3Ccircle id='Ellipse_141' data-name='Ellipse 141' cx='24' cy='24' r='24' transform='translate(-22919 -22848)' fill='rgba(255,255,255,0)'/%3E%3Cg id='Group_27880' data-name='Group 27880'%3E%3Crect id='Rectangle_4745' data-name='Rectangle 4745' width='6' height='24' rx='3' transform='translate(-22904 -22836)' fill='%23fff'/%3E%3Crect id='Rectangle_4746' data-name='Rectangle 4746' width='6' height='24' rx='3' transform='translate(-22891 -22836)' fill='%23fff'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E%0A`;
        var playImg = `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='48' height='48' viewBox='0 0 48 48'%3E%3Cg id='is-paly' transform='translate(22983 22848)'%3E%3Ccircle id='Ellipse_140' data-name='Ellipse 140' cx='24' cy='24' r='24' transform='translate(-22983 -22848)' fill='rgba(255,255,255,0)'/%3E%3Cpath id='Polygon_6' data-name='Polygon 6' d='M12.527,6.078a4,4,0,0,1,6.946,0L28.58,22.015A4,4,0,0,1,25.107,28H6.893A4,4,0,0,1,3.42,22.015Z' transform='translate(-22942 -22840) rotate(90)' fill='%23fff'/%3E%3C/g%3E%3C/svg%3E%0A`;
        var playButtonStyle = 'display: block; align-items: center; justify-content: flex-start; width: auto; padding: 5px 5px 5px 30px; text-indent: initial; font: initial; color: rgb(255, 255, 255); border-radius: 4px; background: url("' + playImg + '")';
        if ($li_all_width - $li_length >= $mask_width) { //如果播放物件比框框大

            var url = window.location.href;
            //新增左右按鈕
            if (url.indexOf("/EN/") >= 0 || url.indexOf("/en/") >= 0) {
                _playButton_tools = '<div class="ctrl_btn"><a class="is-play" href="#" role="button" title="Slideshow[playing]" Style="' + playButtonStyle + '">Playing</a></div>';//撥放按鈕
                $ctrl_tools.prepend('<a class="ctrl_left" href="#" title="Previous" role="button">&lsaquo;</a>');
                $ctrl_tools.append('<a class="ctrl_right" href="#" title="Next" role="button">&rsaquo;</a>');
            } else {
                _playButton_tools = '<div class="ctrl_btn"><a class="is-play" href="#" role="button" title="輪播功能[正在播放中]" Style="' + playButtonStyle + '">播放中</a></div>';//撥放按鈕
                $ctrl_tools.prepend('<a class="ctrl_left" href="#" title="上一張" role="button">&lsaquo;</a>');
                $ctrl_tools.append('<a class="ctrl_right" href="#" title="下一張" role="button">&rsaquo;</a>');
            }
            $this.find('.banner_slider_box').prepend(_playButton_tools);//新增撥放在輪播最前面
        } else {
            return false;
        }

        var $ctrl_left = $ctrl_tools.find('.ctrl_left').data('dir', 0), //抓左右按鈕並設定方向參數
            $ctrl_right = $ctrl_tools.find('.ctrl_right').data('dir', 1),
            $btns = $ctrl_left.add($ctrl_right); //取按鈕集
        var $ctrl_btn = $this.find('.ctrl_btn'),  //播放按鈕上一層框架
            $play_btn = $ctrl_btn.find('a');  //播放按鈕
        $ctrl_btn.css({
            "position": "absolute",
            "top": "5px",
            "right": "40px"
        });
        $btns.click(function (event) {
            event.preventDefault(); //停止預設動作

            //取物件
            var $this = $(this),
                _dir = $this.data('dir'); //取方向參數

            slider(_dir);
        });

        $this.touchwipe({
            wipeLeft: function () { slider(1); clearTimeout(timer); },
            wipeRight: function () { slider(0); clearTimeout(timer); },
            min_move_x: 20,
            min_move_y: 20,
            preventDefaultEvents: false
        });

        if (_slider) { //如果要輪播
            var timer; //設定計時器

            //設定輪播涵式
            function auto() {
                slider(1);
                isPlay = 1;
                play_btn_change(isPlay);
                timer = setTimeout(auto, _sliderSpeed);

            }

            //設定滑進滑出項目(取消)
            //$this.mouseover(function () {
            //    clearTimeout(timer);
            //});
            //$this.mouseout(function () {
            //    var focusedElement = $(document.activeElement);
            //    //有tag到a的時候關閉滑入播放以免衝突
            //    if (focusedElement.prop('tagName') != 'A') {
            //        timer = setTimeout(auto, _sliderSpeed);
            //    }
            //});
            //按鍵跳起
            $this.keyup(function (e) {
                if (e.key === "Enter" || e.keyCode === 13) {
                    // 按下 Enter 時不執行下方程式碼
                    return;
                }
                isPlay = 0;
                play_btn_change(isPlay);
                clearTimeout(timer);
            });
            //胖頁尾按鈕事件(取消)
            //$('#closemenu a').focus(function () {
            //    clearTimeout(timer);
            //    timer = setTimeout(auto, _sliderSpeed);
            //});
            //$('#openmenu a').focus(function () {
            //    clearTimeout(timer);
            //    timer = setTimeout(auto, _sliderSpeed);

            //});
            $play_btn.on('click', function (event) {
                event.preventDefault();
                // 切換控制項樣式及狀態
                if (isPlay == 0) {
                    isPlay = 1;
                    play_btn_change(isPlay);
                    timer = setTimeout(auto, _sliderSpeed);
                }
                else if (isPlay == 1) {
                    isPlay = 0;
                    isClick = true;
                    play_btn_change(isPlay);
                    clearTimeout(timer);
                }
            });
            //改變按鈕狀態
            function play_btn_change(isPlay) {
                if (isPlay == 0) {
                    $play_btn.removeClass('is-play').addClass('is-Pause');
                    if (url.indexOf("/EN/") >= 0 || url.indexOf("/en/") >= 0) {
                        $play_btn.text('Pause').attr('title', 'Slideshow[pausing]');
                    }
                    else {
                        $play_btn.text('暫停中').attr('title', '輪播功能[暫停中]');
                    }
                    $play_btn.css('background', `url("${pauseImg}") no-repeat 0px 4px / 35% #505050`);
                }
                else if (isPlay == 1) {
                    $play_btn.removeClass('is-pause').addClass('is-play');

                    if (url.indexOf("/EN/") >= 0 || url.indexOf("/en/") >= 0) {
                        $play_btn.text('Playing').attr('title', 'Slideshow[playing]');
                    }
                    else {
                        $play_btn.text('播放中').attr('title', '輪播功能[播放中]');
                    }
                    $play_btn.css('background', `url("${playImg}")  no-repeat 0px 4px / 35% #505050`);
                }
            }
            //輪播開始
            play_btn_change(isPlay);
            timer = setTimeout(auto, _sliderSpeed);
        }

        function slider(_away) {

            $slider_dom = $(); //清空輪播物件

            //取要計算的寬度
            $mask_width = $mask.width(); //取遮罩寬度
            $li_width = $li.width(); //取li寬度
            $li_all_width = $li_width * $li_length; //算出所有li總和寬度

            if ($li_all_width - $li_length >= $mask_width) { //如果播放物件比框框大

                $ctrl_tools.show();

                var _offset = '-100%',
                    _num = Math.round($mask_width / $li_width);

                if (!_all) { //如果不是撥整塊
                    _offset = '-' + (100 / _num) + '%'; //把li寬度換算成%
                    _num = 1;
                }

                $li = $ul.children('li'); //重取dom

                if (_away) { //如果往右

                    for (i = 0; i < _num; i++) {
                        $slider_dom = $slider_dom.add($li.eq(i));
                    }

                    $ul.stop().animate({
                        'margin-left': _offset //讓ul變成-$li_width
                    }, _animateSpeed, function () {
                        $slider_dom.appendTo($ul); //把最後一個變成第一個
                        $ul.css('margin-left', 0); //調整margin-left為0
                    });

                } else { //如果往左

                    for (i = -1; i >= -1 * _num; i--) {
                        $slider_dom = $slider_dom.add($li.eq(i));
                    }

                    $ul.css('margin-left', _offset); //預先調整margin-left
                    $slider_dom.prependTo($ul); //把最後一個變成第一個

                    $ul.stop().animate({
                        'margin-left': 0 //讓ul變成-$li_width
                    }, _animateSpeed);
                }
            } else {
                $ctrl_tools.hide();
            }
        }
    });
}

// 高市府假日版
$.fn.holi_oka_banner_slider_model = function ($setting) {

    //取所有輪播物件
    var $models = $(this);

    $models.each(function () {

        //取物件 & 參數
        var $this = $(this), //取情境
            _slider = $this.data('slider'), //是否輪播
            _all = $this.data('all'), //是否輪播
            _sliderSpeed = $this.data('sliderspeed') || 5000, //切換速度
            _animateSpeed = $this.data('animatespeed'), //動畫速度
            $mask = $this.find('.banner_mask'),
            $ul = $mask.children('ul'), //取播放物件
            $main_slide = $('.main_slide'),
            $main_slide_img = $main_slide.find('img');

        $ul.children('li').each(function () {
            var $this = $(this);

            if ($this.css('display') === 'none') {
                $this.remove();
            }
        });

        var $li = $ul.children('li'),
            $li_length = $li.length,
            $ctrl_tools = $this.find('.model_ctrl_tools');

        $li.eq(0).addClass('is-active');

        var $slider_dom = $();

        var $mask_width = $mask.width(), //取遮罩寬度
            $li_width = $li.width(), //取li寬度
            $li_all_width = $li_width * $li_length; //算出所有li總和寬度

        if ($li_all_width - $li_length >= $mask_width) { //如果播放物件比框框大

            //新增左右按鈕
            var url = window.location.href;
            //新增左右按鈕
            if (url.indexOf("/EN/") >= 0 || url.indexOf("/en/") >= 0) {
                $ctrl_tools.prepend('<a class="ctrl_left" href="#" title="Previous" role="button">&lsaquo;</a>');
                $ctrl_tools.append('<a class="ctrl_right" href="#" title="Next" role="button">&rsaquo;</a>');
            } else {
                $ctrl_tools.prepend('<a class="ctrl_left" href="#" title="上一張" role="button">&lsaquo;</a>');
                $ctrl_tools.append('<a class="ctrl_right" href="#" title="下一張" role="button">&rsaquo;</a>');
            }

        } else {
            return false;
        }

        var $ctrl_left = $ctrl_tools.find('.ctrl_left').data('dir', 0), //抓左右按鈕並設定方向參數
            $ctrl_right = $ctrl_tools.find('.ctrl_right').data('dir', 1),
            $btns = $ctrl_left.add($ctrl_right); //取按鈕集

        $btns.click(function (event) {
            event.preventDefault(); //停止預設動作

            //取物件
            var $this = $(this),
                _dir = $this.data('dir'); //取方向參數

            slider(_dir);
        });

        $this.touchwipe({
            wipeLeft: function () { slider(1); clearTimeout(timer); },
            wipeRight: function () { slider(0); clearTimeout(timer); },
            min_move_x: 20,
            min_move_y: 20,
            preventDefaultEvents: false
        });

        if (_slider) { //如果要輪播
            var timer; //設定計時器

            //設定輪播涵式
            function auto() {
                slider(1);
                timer = setTimeout(auto, _sliderSpeed);
            }

            //設定滑進滑出項目
            $this.mouseover(function () {
                clearTimeout(timer);
            });

            $this.mouseout(function () {
                timer = setTimeout(auto, _sliderSpeed);
            });

            //輪播開始
            timer = setTimeout(auto, _sliderSpeed);
        }

        function slider(_away) {

            $slider_dom = $(); //清空輪播物件

            //取要計算的寬度
            $mask_width = $mask.width(); //取遮罩寬度
            $li_width = $li.width(); //取li寬度
            $li_all_width = $li_width * $li_length; //算出所有li總和寬度

            if ($li_all_width - $li_length >= $mask_width) { //如果播放物件比框框大

                $ctrl_tools.show();

                var _offset = '-100%',
                    _num = Math.round($mask_width / $li_width);

                if (!_all) { //如果不是撥整塊
                    _offset = '-' + (100 / _num) + '%'; //把li寬度換算成%
                    _num = 1;
                }

                $li = $ul.children('li'); //重取dom

                if (_away) { //如果往右

                    for (i = 0; i < _num; i++) {
                        $slider_dom = $slider_dom.add($li.eq(i));
                    }

                    $ul.stop().animate({
                        'margin-left': _offset //讓ul變成-$li_width
                    }, _animateSpeed, function () {
                        $slider_dom.appendTo($ul); //把最後一個變成第一個
                        $ul.css('margin-left', 0); //調整margin-left為0

                        $li = $ul.children('li'); //重取dom

                        var $current = $li.eq(0),
                            $current_img = $current.find('img'),
                            $this_li_a = $li.find('a')
                        $this_a_img = $this_li_a.find('img');

                        $li.removeClass('is-active');
                        $current.addClass('is-active');

                        $main_slide_img.attr('src', $current_img.attr('src'));
                    });

                } else { //如果往左

                    for (i = -1; i >= -1 * _num; i--) {
                        $slider_dom = $slider_dom.add($li.eq(i));
                    }

                    $ul.css('margin-left', _offset); //預先調整margin-left
                    $slider_dom.prependTo($ul); //把最後一個變成第一個

                    $ul.stop().animate({
                        'margin-left': 0 //讓ul變成-$li_width
                    }, _animateSpeed, function () {
                        $li = $ul.children('li'); //重取dom

                        var $current = $li.eq(0),
                            $current_img = $current.find('img'),
                            $this_li_a = $li.find('a')
                        $this_a_img = $this_li_a.find('img');

                        $li.removeClass('is-active');
                        $current.addClass('is-active');

                        $main_slide_img.attr('src', $current_img.attr('src'));

                    });
                }

            } else {
                $ctrl_tools.hide();
            }
        }
    });
}

//跑馬燈
$.fn.marquee = function ($setting) {

    //取所有輪播物件
    var $models = $(this);

    $models.each(function () {

        //取物件 & 參數
        var $this = $(this), //取情境
            _sliderSpeed = $this.data('sliderspeed'), //切換速度
            _animateSpeed = $this.data('animatespeed'), //動畫速度
            $box = $this.find('.marquee_box'),
            $ul = $box.find('ul'),
            $li = $box.find('li'),
            $li_length = $li.length,
            $li_h = $li.eq(0).outerHeight(true);

        $box.css({
            'height': $li_h
        });

        $li.css({
            'display': 'block'
        })

        function marquee() {

            $ul.animate({
                'margin-top': -1 * $li_h
            }, _animateSpeed, function () {
                $li.eq(0).appendTo($ul); //把第一個變成最後一個
                $ul.css('margin-top', 0); //調整margin-left為0
            });

            $li = $box.find('li'); //重取dom
        }

        var timer; //設定計時器

        function auto() { //輪播
            marquee();
            timer = setTimeout(auto, _sliderSpeed);
        }

        $this.mouseover(function () { //設定滑進滑出輪播區塊
            clearTimeout(timer);
        });

        $this.mouseout(function () {
            timer = setTimeout(auto, _sliderSpeed);
        });
        $this.keyup(function () { //鍵盤跳起來停止輪播
            clearTimeout(timer);

        });
        $this.keydown(function () { //鍵盤按下開始輪播
            timer = setTimeout(auto, _sliderSpeed);
        });

        timer = setTimeout(auto, _sliderSpeed); //輪播開始
    });
}

$.fn.main_menu = function ($setting) {

    var $this = $(this),
        $li = $this.children('li'), //第一層li
        $li_length = $li.length,
        odd_ie = window.oldIE || isOldIE(), //存判斷結果
        $a = $this.find('.menu').children('a'),
        $all_a = $this.find('a'),
        $submenuarea = $this.find('.submenuarea,.submenuarea2'),
        $submenuarea_a = $submenuarea.find('a');

    if ($this.attr('id') === 'menu') {

        $all_a.each(function () { //檢查所有的a
            var $this = $(this);

            if ($this.data('pic')) { //如果有圖片屬性
                var _src = $this.data('pic'); //取出路徑

                $this.html('<img src="' + _src + '">');

                var $img = $this.find('img');

                if ($this.data('hover-pic')) { //如果有hover圖片路徑
                    var _hover_src = $this.data('hover-pic'); //就取出來

                    $this.mouseenter(function () { //進入時套用
                        $img.attr('src', _hover_src);
                    });

                    $this.mouseleave(function () { //離開時還原
                        $img.attr('src', _src);
                    });
                }
            }
        });

        //判斷瀏覽器版本&是否大於6個項目
        if (odd_ie && $li.css('float') && $li.css('float') !== 'none' && $li_length > 6) { //如果是 IE6 - IE8，有寫浮動，大於六個選單
            $li.css('width', 100 / $li.length + '%'); //指定寬度
        }

        $submenuarea.stop().hide(0);

        $a.focus(function () {
            $submenuarea.hide(0);
            $(this).closest('li').find('.submenuarea,.submenuarea2').stop().fadeIn(150);
        });

        $all_a.eq(-1).blur(function () {
            $submenuarea.stop().fadeOut(150, function () {
                $submenuarea.css('overflow', 'visible');
            });
        });

        $li.mouseenter(function () {
            $(this).find('.submenuarea,.submenuarea2').stop().fadeIn(150);
        });

        $li.mouseleave(function () {
            $submenuarea.stop().fadeOut(150, function () {
                $submenuarea.css('overflow', 'visible');
            });
        });

    } else if ($this.attr('id') === 'menu2') {

        var _className = 'is-open';

        $li.each(function () {
            var $this = $(this);

            if ($this.find('.submenuarea,.submenuarea2').length) {
                $this.addClass('is-parent');
                $this.find('.menu a').attr('role', 'button');
            }
        });

        $next_a = $this.find('.is-parent').find('.menu a');

        $next_a.on('click focusin', function (evt) {
            evt.preventDefault();

            var $this = $(this);

            $this.trigger('menu_open');
        });

        $next_a.on('menu_open', function () {
            var $this = $(this),
                $a_parent_li = $this.closest('li');

            $li.removeClass(_className);
            $a_parent_li.addClass(_className);
        });
    }
}

//tab切換
$.fn.oka_tab_model = function (setting) {
    var $this = $(this),
        $set = setting || {};

    $this.each(function () { //頁面中每一個頁面區塊都run一次
        var $this = $(this),
            $a = $this.find('a'),
            $hrefs = $('');

        if ($a.length <= 1) { //如果不到一個項目，就只幫 $a 加 .active

            $a.addClass('tabs_yes');
            $a.attr('aria-selected', 'true');
        } else {

            $a.each(function (i) { //把每一個頁籤內頁隱藏
                var $href = $($(this).attr('href')),
                    $target_last_a = $href.find('a').eq(-1),
                    $target_first_a = $href.find('a').eq(0);

                $hrefs = $hrefs.add($href); //把連結目標加入 $hrefs
                $href.hide(); //隱藏連結目標

                if ((i + 1) < $a.length) {

                    $target_last_a.on('keydown', function (event) {

                        if (event.keyCode == 9 && !event.shiftKey) {
                            event.preventDefault();

                            $a.eq(i + 1).focus();
                        }
                    });
                }
                $target_first_a.on('keydown', function (event) {
                    if (event.shiftKey && event.keyCode == 9) {
                        event.preventDefault();
                        $a.eq(i).focus();
                    }
                });
            });

            $a.on('keydown focus', function (event) {
                var $this = $(this),
                    _index = $this.closest('li').index(),
                    $target = $($this.attr('href')),
                    $target_a = $target.find('a'),
                    $target_first_a = $target_a.eq(0);

                if ($target_first_a.length == 0) return;

                if (event.shiftKey && event.keyCode == 9) {
                    // Shift + Tab
                    $a.each(function (i) {
                        if ($a.eq(i).is(":focus")) {
                            if (i != 0) {
                                event.preventDefault();
                                var $before_item = $($a.eq(i - 1).attr('href')),
                                    $before_item_a = $before_item.find('a');
                                $a.eq(i - 1).click();
                                $before_item_a.eq(-1).focus();
                            }
                            // 如果是第一個 tab，就不做 preventDefault，讓瀏覽器自然處理
                        }
                    });
                } else if (event.keyCode == 9) {
                    // Tab
                    event.preventDefault();
                    $target_first_a.focus();
                }
            });
            $a.on('keydown', function (event) {

                //if (event.shiftKey && event.keyCode == 9) {
                //    $a.each(function (i) {
                //        if ($a.eq(i).is(":focus")) {
                //            console.log("focus" + i);
                //        }
                //    });
                //}

            });
            $a.on('changeTab', function (event) {
                event.preventDefault(); //停止預設動作
                var $this = $(this),
                    $href = $($this.attr('href')); //取出連結目標

                $a.removeClass('tabs_yes'); //加入與取走active
                $a.removeAttr('aria-selected');
                $this.addClass('tabs_yes');
                $this.attr('aria-selected', 'true');

                $a.parent().removeClass('tabs_yes'); //加入與取走active
                $this.parent().addClass('tabs_yes');

                $hrefs.hide(); //顯示與隱藏
                $href.show();

            });

            $a.on('click', function (event) {
                event.preventDefault(); //停止預設動作

                $(this).trigger('changeTab');
            });

            $a.on('focusin', function (event) {

                $(this).trigger('changeTab');
            });

            $a.eq(0).trigger('changeTab'); //點第一個
        }
    });
}

//全文檢索關鍵字
$.fn.oka_keyword_model = function (setting) {
    var $this = $(this),
        $set = setting || {},
        $txt = $(this).find('input[type="text"]'),
        $ul = $(this).find('ul'),
        $Words = $ul.find('a');
    var isOverUl = false;

    $txt.keyup(function () {
        $ul.show();
        doSearch($txt.val());
    });
    $Words.click(function (e) {
        e.preventDefault();
        $txt.val($(this).html());
        $ul.hide();
    });
    $ul.mouseover(function () {
        isOverUl = true;
    });
    $ul.mouseleave(function () {
        isOverUl = false;
    });

    $txt.focusout(function () {
        if (!isOverUl) {
            $ul.hide();
        }
    });

    function doSearch(keyWord) {
        keyWord = keyWord.toLowerCase();
        $ul.find('li').each(function () {
            var Word = $(this).find('a').html().toLowerCase()
            $(this).hide();
            if (Word.indexOf(keyWord) > -1) {
                $(this).show();
            }
        })
    }
}

$.fn.dic = function () {

    var $window = $('.dic-window');

    var _speed = 200;

    if (!$window.length) { //如果沒有window
        $window = $('<div class="dic-window"><div class="dic-hd">名詞庫</div><div class="dic-ct"><div class="dic-caption"></div><div class="dic-p"></div></div><div class="dic-ft"><a href="#" title="關閉" class="dic-close">關閉</a><a href="#" target="_black" title="更多" class="dic-more">我想了解</a></div></div>').appendTo('body');
    }

    var $caption = $window.find('.dic-caption'),
        $p = $window.find('.dic-p'),
        $close = $window.find('.dic-close'),
        $more = $window.find('.dic-more');

    var $this = $(this); //標籤

    $this.on('click', function (evt) {
        evt.preventDefault();

        hideDic();

        setContent({ //更新內容
            'heading': '黑面琵鷺',
            'content': '又名小琵鷺、黑面鷺、黑琵鷺、琵琶嘴鷺，俗稱飯匙鳥、黑面勺嘴，台灣賞鳥人士則俗稱為「黑琵」[3][註 1]。因其扁平如湯匙狀的長嘴，與中國樂器中的琵琶極為相似，因而得名；亦因其姿態優雅，又被稱為「黑面天使」或「黑面舞者」；屬於鸛形目、䴉科、琵鷺亞科，琵鷺亞科的鳥類全世界共六種，其中以黑面琵鷺數量最為稀少（已知六種琵鷺當中唯黑面琵鷺屬瀕危物種），屬全球瀕危物種類別之一。於故當黑面琵鷺在每年 1月至 3月渡冬時，東南亞觀鳥者會到處觀測關注其過冬狀況並統計數量。黑面琵鷺現時只活躍於東亞及東南亞地區。',
            'link': 'http://www.google.com'
        });

        setPosition($this); //設定定位

        showDic();
    });

    $close.on('click', function (evt) {
        evt.preventDefault();

        hideDic();
    });

    function setContent(obj) { //設定資料

        $caption.text(obj.heading);
        $p.text(obj.content);
        $more.attr('href', obj.link);
    }

    function setPosition($node) { //設定

        var $screen_w = $(window).width(), //視窗寬度
            $window_w = $window.outerWidth(); //框寬度

        var $node_o = $node.offset(),
            $node_t = $node_o.top,
            $node_l = $node_o.left,
            $node_h = $node.height();

        if ($window_w + $node_l > $screen_w) { //如果超過螢幕，就縮回來
            $node_l = $screen_w - $window_w;
        }

        $window.css({
            'top': $node_t + $node_h,
            'left': $node_l
        });
    }

    function showDic(obj) { //顯示
        $window.stop().fadeIn(_speed);
    }

    function hideDic() { //隱藏
        $window.stop().fadeOut(_speed);
    }
}


$(function () {
    var $menubg = $('.menubg'),
        $menuarea = $menubg.find('.menuarea'),
        $menu = $('#menu');

    if (!$menu.length) { return false; }

    var $menu_h = $menuarea.height(),
        $menu_t = $menu.offset().top,
        _class_name = 'is-fixed';

    $(window).on('scroll resize', function () { //捲動事件
        var $this = $(this),
            $this_Top = $this.scrollTop();

        if ($this_Top > $menu_t) {
            $menubg.height($menu_h);
            $menubg.addClass(_class_name);
        } else {
            $menubg.css({ 'height': 'auto' });
            $menubg.removeClass(_class_name);
        }

    }).scroll();
});

$(function () { //調整字體大小
    var $body = $('body'),
        $font_size_btn = $('.fontlevel').find('a'), //抓a
        _font_size = 'm';

    if ($.cookie && $.cookie('font_size')) { _font_size = $.cookie('font_size') } //找cookie，沒有就給預設值


    $font_size_btn.click(function (evt) {
        evt.preventDefault();

        var $this = $(this),
            _font_size = $this.data('font-size');

        $font_size_btn.removeClass('is_active');
        $this.addClass('is_active');

        $.cookie('font_size', _font_size); //存cookie

        $body.attr('class', 'font-size-' + _font_size); //改class值
    });

    $font_size_btn.filter('[data-font-size="' + _font_size + '"]').click();
});

//組織職掌table顯示

$(function () {

    var table_detail = false;
    var $click_more = $('.click_more');

    $click_more.click(function () {

        if (table_detail == false) {
            $(this).next('table').addClass('block_switch');

            table_detail = true;
        } else {
            $(this).next('table').removeClass('block_switch');

            table_detail = false;
        }

        return false;
    })

});

//市政新聞搜尋方式
$(function () {

    var $filter_1 = $('.filter_1'),
        $filter_2 = $('.filter_2'),
        $filter_3 = $('.filter_3'),
        $filter_select = $('.filter_select');

    $filter_1.hide();
    $filter_2.hide();
    $filter_3.hide();

    $filter_select.change(function () {

        $filter_1.hide();
        $filter_2.hide();
        $filter_3.hide();

        if ($(this).val() == 0) {
            $filter_1.hide();
            $filter_2.hide();
            $filter_3.hide();
        }

        $(".filter_" + $(this).val()).show();
    });
});


//表單下載

$(function () {
    var $form_list = $('.form_list'),
        $form_h5 = $form_list.find('h5'),
        $form_open = $form_h5.find('a'),
        $list_ul = $form_list.find('ul'),
        $window_w = $(window).width();

    ul_toggle = false;

    $form_open.click(function () {
        if (ul_toggle == false) {
            $(this).parent('h5').next('ul').addClass('block_switch');

            ul_toggle = true;
        } else {
            $(this).parent('h5').next('ul').removeClass('block_switch');

            ul_toggle = false;
        }

        return false;
    });

});

$(function () {
    var $search_keyword = $('.search_keyword'),
        $search_btn = $search_keyword.find('.search_btn'),
        $search = $search_keyword.find('.search'),
        $hot = $search_keyword.next('.hot_search');
    $last_a = $hot.find('a:last-child');

    var _search_switch = false;


    $search_btn.click(function () {
        if (_search_switch == false) {
            $search.show();
            $hot.show();
            _search_switch = true;
        } else {
            $search.hide();
            $hot.hide();
            _search_switch = false;
        }
    });

    $search_btn.on('focusin', function (evt) {
        evt.preventDefault();

        $search.show();
        $hot.show();
    });

    $last_a.on('focusout', function (evt) {
        evt.preventDefault();

        $search.hide();
        $hot.hide();
    });
});

$(function () {

    var $cate = $('.e_service_tab'),
        $cate_ul = $cate.find('ul'),
        $cate_list = $cate_ul.find('li'),
        $cate_a = $cate_list.find('a'),
        $cate_all = $cate_a.next('ul'),
        $cate_all_list = $cate_all.find('li:last-child'),
        $cate_list_a = $cate_all_list.find('a');

    $cate_a.on('focusin', function () {
        $cate_list.addClass('is-active');
        $(this).next('ul').show();
    });

    $cate_list_a.on('focusout', function () {
        $cate_all.hide();
        $cate_list.removeClass();
    });


});

//網頁load後執行
$(function (i) {

    $('[data-function]').each(function () {
        $(this)[$(this).data('function')]();
    });
});

$(function () {
    $('body').attr('data-js', true); //回傳結果給拖曳根節點，是否有開啟 js
});
